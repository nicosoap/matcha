{"version":3,"sources":["picture-compiled-compiled-compiled-compiled.js"],"names":[],"mappings":"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","file":"picture-compiled-compiled-compiled-compiled-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.uploadPicture = undefined;\n\nvar registerPicture = function () {\n    var _ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee(login, filename, ext) {\n        var payload, db;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n                switch (_context.prev = _context.next) {\n                    case 0:\n                        payload = { user: login, filename: filename, ext: ext, date: Date.now() };\n\n                        console.log(payload);\n                        _context.next = 4;\n                        return dbl.connect();\n\n                    case 4:\n                        db = _context.sent;\n                        _context.prev = 5;\n                        _context.next = 8;\n                        return db.collection('pictures').insertOne(payload);\n\n                    case 8:\n                        return _context.abrupt('return', _context.sent);\n\n                    case 9:\n                        _context.prev = 9;\n\n                        db.close();\n                        return _context.finish(9);\n\n                    case 12:\n                    case 'end':\n                        return _context.stop();\n                }\n            }\n        }, _callee, this, [[5,, 9, 12]]);\n    }));\n\n    return function registerPicture(_x, _x2, _x3) {\n        return _ref.apply(this, arguments);\n    };\n}();\n\nvar uploadPicture = exports.uploadPicture = function () {\n    var _ref2 = _asyncToGenerator(regeneratorRuntime.mark(function _callee2(req, res) {\n        var mimes, ext, result;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n                switch (_context2.prev = _context2.next) {\n                    case 0:\n                        console.log(req.file);\n                        mimes = [\"image/jpeg\", \"image/gif\", \"image/png\"];\n                        ext = req.file.originalname;\n\n                        console.log(ext);\n                        console.log(req.file.mimetype);\n\n                        if (!(mimes.indexOf(req.file.mimetype) != -1)) {\n                            _context2.next = 14;\n                            break;\n                        }\n\n                        ext = ext.match(/.*(\\.gif|\\.png|\\.jpg|\\.jpeg)$/i)[1];\n                        console.log(ext);\n                        _context2.next = 10;\n                        return registerPicture(req.user.username, req.file.filename, ext);\n\n                    case 10:\n                        result = _context2.sent;\n\n                        if (result.ok) {\n                            res.send({ success: true, message: _errno_code2.default.PICTURE_UPLOAD_SUCCESS });\n                        } else {\n                            res.send({ success: false, message: _errno_code2.default.PICTURE_REGISTER_ERROR });\n                        }\n                        _context2.next = 15;\n                        break;\n\n                    case 14:\n                        res.send({ success: false, message: _errno_code2.default.PICTURE_UPLOAD_ERROR });\n\n                    case 15:\n                    case 'end':\n                        return _context2.stop();\n                }\n            }\n        }, _callee2, this);\n    }));\n\n    return function uploadPicture(_x4, _x5) {\n        return _ref2.apply(this, arguments);\n    };\n}();\n\nvar _fs = require('fs');\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar _expressSession = require('express-session');\n\nvar _expressSession2 = _interopRequireDefault(_expressSession);\n\nvar _bcrypt = require('bcrypt');\n\nvar _bcrypt2 = _interopRequireDefault(_bcrypt);\n\nvar _dbConnect = require('./dbConnect');\n\nvar dbl = _interopRequireWildcard(_dbConnect);\n\nvar _credentials = require('../credentials');\n\nvar _credentials2 = _interopRequireDefault(_credentials);\n\nvar _mongodb = require('mongodb');\n\nvar _mongodb2 = _interopRequireDefault(_mongodb);\n\nvar _jsonwebtoken = require('jsonwebtoken');\n\nvar _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);\n\nvar _nodemailer = require('nodemailer');\n\nvar _nodemailer2 = _interopRequireDefault(_nodemailer);\n\nvar _errno_code = require('./errno_code');\n\nvar _errno_code2 = _interopRequireDefault(_errno_code);\n\nvar _match = require('../model/match');\n\nvar _match2 = _interopRequireDefault(_match);\n\nfunction _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n        return obj;\n    } else {\n        var newObj = {};if (obj != null) {\n            for (var key in obj) {\n                if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n            }\n        }newObj.default = obj;return newObj;\n    }\n}\n\nfunction _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : { default: obj };\n}\n\nfunction _asyncToGenerator(fn) {\n    return function () {\n        var gen = fn.apply(this, arguments);return new Promise(function (resolve, reject) {\n            function step(key, arg) {\n                try {\n                    var info = gen[key](arg);var value = info.value;\n                } catch (error) {\n                    reject(error);return;\n                }if (info.done) {\n                    resolve(value);\n                } else {\n                    return Promise.resolve(value).then(function (value) {\n                        return step(\"next\", value);\n                    }, function (err) {\n                        return step(\"throw\", err);\n                    });\n                }\n            }return step(\"next\");\n        });\n    };\n} // ************************************************************************** //\n//                                                                            //\n//                                                        :::      ::::::::   //\n//   picture.js                                            :+:      :+:    :+:   //\n//                                                    +:+ +:+         +:+     //\n//   By: opichou <marvin@42.fr>                     +#+  +:+       +#+        //\n//                                                +#+#+#+#+#+   +#+           //\n//   Created: 2016/09/19 18:27:53 by opichou           #+#    #+#             //\n//   Updated: 2016/09/29 18:27:53 by opichou          ###   ########.fr       //\n//                                                                            //\n// ************************************************************************** //\n\n//# sourceMappingURL=picture-compiled.js.map\n\n//# sourceMappingURL=picture-compiled-compiled.js.map\n\n//# sourceMappingURL=picture-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=picture-compiled-compiled-compiled-compiled.js.map"]}