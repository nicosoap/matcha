{"version":3,"sources":["user-compiled.js"],"names":[],"mappings":"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","file":"user-compiled-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.userLogin = userLogin;\nexports.checkLogin = checkLogin;\nexports.checkEmail = checkEmail;\nexports.changePassword = changePassword;\nexports.retrievePassword = retrievePassword;\nexports.Delete = Delete;\nexports.renderForm = renderForm;\nexports.create = create;\nexports.reactivate = reactivate;\nexports.isVerified = isVerified;\nexports.updateProfile = updateProfile;\nexports.tags = tags;\nexports.addTag = addTag;\nexports.viewAll = viewAll;\n\nvar _fs = require('fs');\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar _expressSession = require('express-session');\n\nvar _expressSession2 = _interopRequireDefault(_expressSession);\n\nvar _bcrypt = require('bcrypt');\n\nvar _bcrypt2 = _interopRequireDefault(_bcrypt);\n\nvar _dbConnect = require('./dbConnect');\n\nvar dbl = _interopRequireWildcard(_dbConnect);\n\nvar _credentials = require('../credentials');\n\nvar _credentials2 = _interopRequireDefault(_credentials);\n\nvar _mongodb = require('mongodb');\n\nvar _mongodb2 = _interopRequireDefault(_mongodb);\n\nvar _jsonwebtoken = require('jsonwebtoken');\n\nvar _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);\n\nvar _nodemailer = require('nodemailer');\n\nvar _nodemailer2 = _interopRequireDefault(_nodemailer);\n\nvar _errno_code = require('./errno_code');\n\nvar _errno_code2 = _interopRequireDefault(_errno_code);\n\nvar _match = require('../model/match');\n\nvar _match2 = _interopRequireDefault(_match);\n\nfunction _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n        return obj;\n    } else {\n        var newObj = {};if (obj != null) {\n            for (var key in obj) {\n                if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n            }\n        }newObj.default = obj;return newObj;\n    }\n}\n\nfunction _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : { default: obj };\n}\n\n// ************************************************************************** //\n//                                                                            //\n//                                                        :::      ::::::::   //\n//   user.js                                            :+:      :+:    :+:   //\n//                                                    +:+ +:+         +:+     //\n//   By: opichou <marvin@42.fr>                     +#+  +:+       +#+        //\n//                                                +#+#+#+#+#+   +#+           //\n//   Created: 2016/09/19 18:27:53 by opichou           #+#    #+#             //\n//   Updated: 2016/09/29 18:27:53 by opichou          ###   ########.fr       //\n//                                                                            //\n// ************************************************************************** //\n\nvar saltRounds = 10;\n\nvar transporter = _nodemailer2.default.createTransport('smtps://apimatcha@gmail.com:apiMatcha1212@smtp.gmail.com');\n\nfunction now() {\n    var currentdate = new Date();\n    return currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" @ \" + currentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n}\n\nasync function genToken(user) {\n    var myToken = await _jsonwebtoken2.default.sign({ username: user.login }, _credentials2.default.jwtSecret);\n    var db = await dbl.connect();\n    try {\n        var update = await db.collection('users').updateOne({ login: user.login }, { $set: { token: myToken } });\n        if (update.modifiedCount == 1) {\n            user.token = myToken;\n\n            console.log(user.login + \" connected: \" + now());\n            return user;\n        } else {\n            console.error(_errno_code2.default.TOKEN_ERROR + user.login);\n            user.success = false;\n            user.message = _errno_code2.default.TOKEN_ERROR;\n            return user;\n        }\n    } catch (err) {\n        console.error(err);\n        user.success = false;\n        user.message = _errno_code2.default.TOKEN_ERROR;\n        return user;\n    } finally {\n        db.close();\n    }\n}\n\nasync function addFingerprint(user, fingerprint) {\n    var db = await dbl.connect();\n    try {\n        db.collection('users').updateOne({ login: user.login }, { $push: { fingerprint: fingerprint } });\n        user.fingerprint = fingerprint;\n        return user;\n    } catch (err) {\n        console.error(err);\n    }\n}\n\nfunction contains(a, obj) {\n    for (var i = 0; i < a.length; i++) {\n        if (a[i] === obj) {\n            return true;\n        }\n    }\n    return false;\n}\n\nasync function basicAuth(login, password, fingerprint, callback) {\n    var db = await dbl.connect();\n    try {\n        await async function () {\n            var user = await db.collection('users').findOne({ $or: [{ login: login, active: true }, { email: login, active: true }] });\n            try {\n                db.close();\n                if (!user) {\n                    callback({ success: false, message: _errno_code2.default.AUTH_ERROR }, {\n                        auth: {\n                            success: false,\n                            message: _errno_code2.default.AUTH_ERROR\n                        }\n                    });\n                } else {\n                    _bcrypt2.default.compare(password, user.password, async function (err, res) {\n                        if (res) {\n                            user = await genToken(user);\n                            console.log(\"Token received\");\n                            if (user.fingerprint && contains(user.fingerprint, fingerprint)) {\n                                var ret = {\n                                    auth: {\n                                        method: \"basic\",\n                                        success: true,\n                                        fingerprint: fingerprint,\n                                        token: user.token,\n                                        message: _errno_code2.default.LOGIN_SUCCESS_INFO\n                                    }\n                                };\n                                callback(err, ret);\n                            } else {\n                                console.log(\"New fingerprint will be added to user profile\");\n                                user = addFingerprint(user, fingerprint);\n                                var _ret2 = {\n                                    auth: {\n                                        method: \"basic\",\n                                        success: true,\n                                        fingerprint: fingerprint,\n                                        token: user.token,\n                                        message: _errno_code2.default.LOGIN_SUCCESS_INFO\n                                    }\n                                };\n                                callback(err, _ret2);\n                            }\n                        } else {\n                            console.log(\"wrong password\");\n                            var _ret3 = {\n                                auth: {\n                                    method: \"basic\",\n                                    success: false,\n                                    fingerprint: fingerprint,\n                                    message: _errno_code2.default.AUTH_PASSWORD_ERROR\n                                }\n                            };\n                            callback(err, _ret3);\n                        }\n                    });\n                }\n            } catch (err) {\n                callback(err, false);\n            }\n        }();\n    } catch (err) {\n        console.error(err);\n    }\n}\n\nasync function tokenAuth(token, fingerprint, callback) {\n    var db = await dbl.connect();\n    var login = _jsonwebtoken2.default.verify(token, _credentials2.default.jwtSecret).username;\n    console.log(\"token auth for user: \" + login);\n    try {\n        var user = await db.collection('users').findOne({ login: login, active: true });\n        if (!user) {\n            var ret = {\n                auth: {\n                    method: \"token\",\n                    success: false,\n                    fingerprint: fingerprint,\n                    message: _errno_code2.default.AUTH_ERROR } };\n            callback(true, ret);\n        } else if (user.fingerprint && contains(user.fingerprint, fingerprint)) {\n            var _ret4 = {\n                auth: {\n                    method: \"token\",\n                    success: true,\n                    fingerprint: fingerprint,\n                    message: _errno_code2.default.LOGIN_SUCCESS_INFO } };\n            callback(false, _ret4);\n        } else {\n            var _ret5 = {\n                auth: {\n                    method: \"token\",\n                    success: true,\n                    fingerprint: false,\n                    message: _errno_code2.default.AUTH_DEVICE_ERROR } };\n            callback(true, _ret5);\n        }\n    } catch (err) {\n        var _ret6 = {\n            auth: {\n                method: \"token\",\n                success: false,\n                fingerprint: fingerprint,\n                message: _errno_code2.default.AUTH_ERROR } };\n        callback(err, _ret6);\n    } finally {\n        db.close();\n    }\n}\n\nasync function userLogin(req, res) {\n    var token = req.headers.authorization.match(/^Bearer (.*)$/)[1];\n    await authenticate(req.body.login, req.body.password, token, req.body.fingerprint, function (err, ret) {\n        if (err || ret.auth.fingerprint == false) {\n            console.error(err);\n            res.setHeader('Content-Type', 'application/json');\n            res.send(JSON.stringify(ret));\n        } else {\n            res.setHeader('Content-Type', 'application/json');\n            res.send(JSON.stringify(ret));\n        }\n    });\n}\n\nasync function authenticate(login, password, token, fingerprint, callback) {\n    //This method authenticates user using basic strategy (username and password) or token based strategy.\n    //The first strategy uses Bcrypt to hash and salt the password.\n    //The latter uses JWT to validate the token.\n    //In any case, if a token doesn't exist, one is generated upon authentication success.\n    //After authenticating, if the device fingerprint isn't recognized, user will be required to confirm his identity\n    // using email.\n    //This function fires a callback when succeeding, this callback takes two arguments: err: boolean and ret: object\n    // containing every info about the authentication and its eventual success, if such, user info and details about\n    // device fingerprint status.\n\n    console.log(\"Connection attempt from: \" + login + ' (token: ' + token + ')');\n    if (token && fingerprint) {\n        tokenAuth(token, fingerprint, callback);\n    } else if (login && password && fingerprint) {\n        basicAuth(login, password, fingerprint, callback);\n    } else {\n        callback({ message: _errno_code2.default.AUTH_ERROR }, { auth: { success: false, message: _errno_code2.default.AUTH_ERROR } });\n    }\n}\n\nasync function checkLogin(req, res, next) {\n    try {\n        var test = await checkLoginHlp(req.params.login);\n        res.setHeader('Content-Type', 'application/json');\n        res.send(JSON.stringify(test));\n    } catch (err) {\n        next(err);\n    }\n}\n\nasync function checkLoginHlp(login) {\n    var db = await dbl.connect();\n    try {\n        var collection = db.collection('users');\n        var userCount = await collection.find({\n            login: login\n        }).limit(1).count();\n        if (userCount == 0 && !/([ ])/.exec(login)) {\n            console.log(\"Login \" + login + \" is valid\");\n            return { valid: true, message: \"Login \" + login + \" is available\", login: login };\n        } else if (/([ ])/.exec(login)) {\n            console.log(\"Login \" + login + \" is not valid\");\n            return { valid: false, message: \"Login \" + login + \" contains whitespace\", login: login };\n        } else {\n            console.log(\"Login \" + login + \" is not valid\");\n            return { valid: false, message: \"Login \" + login + \" isn't available\", login: login };\n        }\n    } finally {\n        db.close();\n    }\n    //this method checks if Login already exists in database\n}\n\nasync function checkEmailHlp(email) {\n    var db = await dbl.connect();\n    try {\n        var collection = db.collection('users');\n        console.log(collection);\n        var userCount = await collection.find({\n            email: email\n        }).limit(1).count();\n        if (userCount == 0 && email.match(/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/ig)) {\n            console.log(\"Email \" + email + \" is valid\");\n            return { valid: true, message: \"Email \" + email + \" is available\", email: email };\n        } else if (userCount == 0) {\n            console.log(\"Email \" + email + \" is not valid\");\n            return { valid: false, error: 1, message: \"Email \" + email + \" is incorrect\", email: email };\n        } else {\n            console.log(\"Email \" + email + \" is not valid\");\n            return { valid: false, error: 2, message: \"A profile already exists for \" + email, email: email };\n        }\n    } finally {\n        db.close();\n    }\n    //this method checks if Email already exists in database\n}\n\nasync function checkEmail(req, res) {\n    try {\n        var test = await checkEmailHlp(req.params.email);\n        res.setHeader('Content-Type', 'application/json');\n        res.send(JSON.stringify(test));\n    } catch (err) {\n        console.error(err);\n    }\n}\n\nasync function checkPass(pass1, pass2) {\n    if (pass1 === pass2 && pass1.match(/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,48}$/)) {\n        console.log(\"Password \" + pass1 + \" is valid\");\n        var _password = await _bcrypt2.default.hashSync(pass1, saltRounds);\n        return { valid: true, message: \"Valid password\", password: _password };\n    } else {\n        console.log(\"Password \" + pass1 + \" is not valid\");\n        return { valid: false, message: _errno_code2.default.PASSWORD_FORMAT_ERROR };\n    }\n}\n\nasync function changePasswordHlp(token, password) {\n    var returnValue = null;\n    await _jsonwebtoken2.default.verify(token, _credentials2.default.jwtSecret, async function (err, ret) {\n        console.log(err.message);\n        if (err) {\n            returnValue = { success: false, message: 'token is corrupted' };\n        } else {\n            var password2 = await _bcrypt2.default.hashSync(password, saltRounds);\n            var _email = ret.email;\n            var db = await dbl.connect();\n            var update = await db.collection('users').updateOne({ email: _email }, { $set: { password: password2 } });\n            try {\n                if (update.modifiedCount == 1) {\n                    returnValue = { success: true, message: \"Password updated successfully\" };\n                } else {\n                    returnValue = { success: false, message: \"An error happened while updating the password\" };\n                }\n            } catch (err) {\n                returnValue = { success: false, message: \"Database error\" };\n            } finally {\n                db.close();\n            }\n        }\n    });\n    return returnValue;\n}\n\nasync function changePassword(req, res) {\n    var token = req.body.token;\n    if (req.body.password === req.body.password2) {\n        var _password2 = req.body.password;\n        var response = await changePasswordHlp(token, _password2);\n        console.log(response);\n        try {\n            console.log(response);\n            res.setHeader('Content-Type', 'application/json');\n            res.send(response);\n        } catch (err) {\n            console.log(err);\n            console.error(err);\n            res.setHeader('Content-Type', 'application/json');\n            res.send(JSON.stringify(response));\n        }\n    } else {\n        res.setHeader('Content-Type', 'application/json');\n        res.send({ success: false, message: \"Passwords didn't match\" });\n    }\n}\n\nasync function requireNewPassword(email) {\n    //this methods sends an email with a temporary link for the user to create a new password\n    var myToken = _jsonwebtoken2.default.sign({ email: email }, _credentials2.default.jwtSecret, { expiresIn: 900 });\n    var db = await dbl.connect();\n    var user = await db.collection('users').findOne({ email: email });\n    try {\n        if (!user || !user.firstName) {\n            return { success: \"false\", message: \"User wasn't found\" };\n        } else {\n            var mailOptions = {\n                from: '\"liveoption\" <customer-success@liveoption.io>', // sender address\n                to: user.email, // list of receivers\n                subject: 'Password reset requested on liveoption',\n                html: '<b>Hello,</b></br><p>A password recovery procedure has been requested ' + 'in your name on liveoption.io. If you requested a new password, please' + ' click on the following link to proceed.</p>' + '<a href=\"http://www.liveoption.io/change_password?token=' + myToken + '\">Change my password now</a>' + '<p>If you didn\\'t request a password reset, please disregard this email</p>' // html body\n            };\n            return await transporter.sendMail(mailOptions);\n        }\n    } catch (err) {\n        console.log(err);\n    } finally {\n        db.close();\n    }\n}\n\nasync function retrievePassword(req, res) {\n    var email = req.body.email;\n    var response = await requireNewPassword(email, res);\n    try {\n        console.log(response);\n        res.setHeader('Content-Type', 'application/json');\n        res.send(response);\n        console.log(response);\n    } catch (err) {\n        console.error(err);\n    }\n}\n\nasync function Delete(req, res) {\n    login = req.body.login;\n    password = req.body.password;\n    fingerprint = req.body.fingerprint;\n    var returnValue = null;\n    //this methods allow deletion of a user account after validating password\n    await authenticate(login, password, '', fingerprint, async function (err, ret) {\n        //remove from database and callback to feedback user in the UI\n        if (ret.auth.success) {\n            var db = await dbl.connect();\n            var status = await db.collection('users').updateOne({ login: \"login\" }, { $set: { active: false } });\n            try {\n                returnValue = status;\n            } catch (err) {\n                console.error(err);\n                returnValue = { success: false, state: \"error\", message: _errno_code2.default.DELETE_ERROR };\n            } finally {\n                db.close();\n            }\n        } else {\n            retrunValue = { success: false, state: \"error\", message: _errno_code2.default.DELETE_ERROR };\n        }\n    });\n    res.setHeader('Content-Type', 'application/json');\n    res.send(JSON.stringify(returnValue));\n}\n\nasync function renderForm(req, res) {\n    var db = await dbl.connect();\n    var response = await db.collection('profileItems').find();\n    try {\n        res.send(response);\n    } finally {\n        db.close();\n    }\n}\n\nasync function create(req, res) {\n    var user = {},\n        errors = [],\n        emailProp = await checkEmailHlp(req.body.email),\n        loginProp = await checkLoginHlp(req.body.login),\n        passwordProp = await checkPass(req.body.password, req.body.password2);\n\n    if (emailProp.valid) {\n        user.email = emailProp.email;\n    } else errors.push(emailProp.message) && console.log(\"email error logged\");\n    if (loginProp.valid) {\n        user.login = loginProp.login;\n    } else errors.push(loginProp.message) && console.log(\"login error logged\");\n    if (passwordProp.valid) {\n        user.password = passwordProp.password;\n    } else errors.push(passwordProp.message) && console.log(\"password error logged\");\n    if (errors.length == 0) {\n        var db = await dbl.connect();\n        await db.collection('users').insertOne(user);\n        try {\n            console.log(\"success\");\n        } finally {\n            db.close();\n        }\n        await validateAccount(email);\n        res.send({ success: true, message: \"User created, please check your emails\" });\n    } else {\n        res.send({ success: false, message: \"Your account couldn't be created\", errors: errors });\n    }\n} //this method adds a new user to the database\n\nasync function reactivate(req, res) {\n    var login = req.body.login,\n        password = req.body.password,\n        db = await dbl.connect();\n    try {\n\n        var user = await db.collection('users').findOneAndUpdate({ login: login, password: password, active: false }, { $set: { active: true } });\n        console.log(user);\n        if (user.nModified != 1) {\n            console.log(\"error\");\n            res.send({ success: false, message: _errno_code2.default.REACTIVATION_ERROR });\n        } else {\n            var myToken = _jsonwebtoken2.default.sign({ email: user.email }, _credentials2.default.jwtSecret, { expiresIn: 9000 }),\n                mailOptions = {\n                from: '\"liveoption\" <customer-success@liveoption.io>', // sender address\n                to: user.email, // list of receivers\n                subject: 'Your account has been reactivated',\n                html: '<b>Hello,</b></br><p>Your liveoption account has just been reactivated.' + 'If you did not request the reactivation of your liveoption account, <a href=\"' + req.get('host') + '/\">please click here.</a></p>' + '<p>Thank you,</p><p>See you soon !</p>'\n            }; // html body\n            res.send((await transporter.sendMail(mailOptions)));\n        }\n    } finally {\n        db.close();\n    }\n} //this method reactivates a previously desactivated account\n\nasync function validateAccount(email) {\n    var myToken = _jsonwebtoken2.default.sign({ email: email }, _credentials2.default.jwtSecret, { expiresIn: 900 });\n    var mailOptions = {\n        from: '\"liveoption\" <customer-success@liveoption.io>', // sender address\n        to: email, // list of receivers\n        subject: 'Pleasee verify your liveoption account',\n        html: '<b>Hello,</b></br><p>You just created a liveoption account. Please click the following link within the next 15mins. to verify your email address.</p>' + '<a href=\"http://www.liveoption.io/account/validate?token=' + myToken + '\">Validate account now</a>' + '<p>Thank you for registering liveoption,</p><p>See you soon !</p>' // html body\n    };\n    return await transporter.sendMail(mailOptions);\n}\n\nasync function isVerified(res, req) {\n    //this method makes sure the user has authorized his account via email\n    var email = req.user.email;\n    var db = await dbl.connect();\n    try {\n        db.collection('users').updateOne({ email: email }, { $set: { active: true } });\n    } finally {\n        db.close();\n    }\n    res.json({ success: true, message: _errno_code2.default.ACCOUNT_VALIDATED_INFO });\n}\n\nasync function updateProfile(req, res) {\n    var db = await dbl.connect();\n    try {\n        var payload = req.body;\n        var _login = req.user.username;\n        addTag(payload.tags);\n        delete payload.tags;\n        await db.collection('users').updateOne({ login: _login }, { $set: payload });\n        res.send({ success: true, message: _errno_code2.default.PROFILE_UPDATED_INFO });\n    } finally {\n        db.close();\n    }\n}\n\nasync function tags(req, res) {\n    var db = await dbl.connect();\n    var response = await db.colletion('tags').find().sort({ count: desc });\n    res.send({ response: response });\n}\n\nasync function addTag(tags) {\n    if ((await tags) === '') {\n        console.log({ status: \"ok\", tagsCreated: 0 });\n    }\n    var db = await dbl.connect();\n    try {\n        await async function () {\n            var bulk = await db.collection('tags').initializeUnorderedBulkOp();\n            await req.body.tags.filter(function (n) {\n                return n != '';\n            }).forEach(async function (n) {\n                bulk.find({ label: n }).upsert().updateOne({ $inc: { count: 1 } });\n            });\n            var result = await bulk.execute({ w: 1 });\n            console.error(result);\n        }();\n    } finally {\n        db.close();\n    }\n}\n\nasync function viewAll(res, req) {\n    res.send({ message: \"OK\" });\n}\n\n//# sourceMappingURL=user-compiled.js.map"]}