{"version":3,"sources":["picture-compiled.js"],"names":[],"mappings":"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","file":"picture-compiled-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.uploadPicture = uploadPicture;\nexports.deleteOne = deleteOne;\nexports.setAsDefault = setAsDefault;\n\nvar _fs = require('fs');\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar _expressSession = require('express-session');\n\nvar _expressSession2 = _interopRequireDefault(_expressSession);\n\nvar _bcrypt = require('bcrypt');\n\nvar _bcrypt2 = _interopRequireDefault(_bcrypt);\n\nvar _dbConnect = require('./dbConnect');\n\nvar dbl = _interopRequireWildcard(_dbConnect);\n\nvar _credentials = require('../credentials');\n\nvar _credentials2 = _interopRequireDefault(_credentials);\n\nvar _mongodb = require('mongodb');\n\nvar _mongodb2 = _interopRequireDefault(_mongodb);\n\nvar _jsonwebtoken = require('jsonwebtoken');\n\nvar _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);\n\nvar _nodemailer = require('nodemailer');\n\nvar _nodemailer2 = _interopRequireDefault(_nodemailer);\n\nvar _errno_code = require('./errno_code');\n\nvar _errno_code2 = _interopRequireDefault(_errno_code);\n\nvar _match = require('../model/match');\n\nvar _match2 = _interopRequireDefault(_match);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// ************************************************************************** //\n//                                                                            //\n//                                                        :::      ::::::::   //\n//   picture.js                                            :+:      :+:    :+:   //\n//                                                    +:+ +:+         +:+     //\n//   By: opichou <marvin@42.fr>                     +#+  +:+       +#+        //\n//                                                +#+#+#+#+#+   +#+           //\n//   Created: 2016/09/19 18:27:53 by opichou           #+#    #+#             //\n//   Updated: 2016/09/29 18:27:53 by opichou          ###   ########.fr       //\n//                                                                            //\n// ************************************************************************** //\n\nasync function registerPicture(login, filename, ext) {\n    var payload = { user: login, filename: filename, ext: ext, active: true, date: Date.now() };\n    console.log(payload);\n    var db = await dbl.connect();\n    try {\n        return await db.collection('pictures').insertOne(payload);\n    } finally {\n        db.close();\n    }\n}\n\nasync function uploadPicture(req, res) {\n    console.log(req.file);\n    var mimes = [\"image/jpeg\", \"image/gif\", \"image/png\"];\n    var ext = req.file.originalname;\n    console.log(ext);\n    console.log(req.file.mimetype);\n    if (mimes.indexOf(req.file.mimetype) != -1) {\n        ext = ext.match(/.*(\\.gif|\\.png|\\.jpg|\\.jpeg)$/i)[1];\n        console.log(ext);\n        var result = await registerPicture(req.user.username, req.file.filename, ext);\n        console.log(result);\n        if (result.insertedCount === 1) {\n            res.send({ success: true, message: _errno_code2.default.PICTURE_UPLOAD_SUCCESS });\n        } else {\n            res.send({ success: false, message: _errno_code2.default.PICTURE_REGISTER_ERROR });\n        }\n    } else {\n        res.send({ success: false, message: _errno_code2.default.PICTURE_UPLOAD_ERROR });\n    }\n}\n\nasync function deleteOne(req, res) {\n    var login = req.user.username;\n    var filename = req.body.filename;\n    var db = await dbl.connect();\n    try {\n        return await db.collection('pictures').updateOne({ login: login, filename: filename, active: true }, { $set: { active: false } });\n    } finally {\n        db.close();\n    }\n}\n\nasync function setAsDefault(req, res) {\n    var login = req.user.username,\n        filename = req.body.filename,\n        db = await dbl.connect();\n    try {\n        db.collection('users').updateOne({ login: login }, { $set: { defaultPicture: filename } });\n    } catch (e) {\n        console.error(e);\n    } finally {\n        db.close();\n    }\n}\n\n//# sourceMappingURL=picture-compiled.js.map"]}