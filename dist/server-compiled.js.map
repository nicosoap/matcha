{"version":3,"sources":["server.js"],"names":[],"mappings":"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","file":"server-compiled.js","sourcesContent":["// ************************************************************************** //\n//                                                                            //\n//                                                        :::      ::::::::   //\n//   server.js                                          :+:      :+:    :+:   //\n//                                                    +:+ +:+         +:+     //\n//   By: opichou <opichou@student.42.fr>            +#+  +:+       +#+        //\n//                                                +#+#+#+#+#+   +#+           //\n//   Created: 2016/09/01 18:27:53 by opichou           #+#    #+#             //\n//   Updated: 2016/09/29 18:27:53 by opichou          ###   ########.fr       //\n//                                                                            //\n// ************************************************************************** //\n\nimport express from 'express';\nimport http from 'http';\nimport fs from 'fs';\nimport parseurl from 'parseurl';\nimport bodyParser from 'body-parser';\nimport session from 'express-session';\nimport * as user from './controllers/user';\nimport * as picture from './controllers/picture';\nimport interactions from './controllers/interactions';\nimport * as admin from './controllers/admin';\nimport credentials from './credentials';\nimport nodemailer from 'nodemailer';\nimport expressJWT from 'express-jwt';\nimport multer from 'multer';\nimport socket from 'socket.io';\nimport path from 'path';\nimport webpack from 'webpack';\nimport webpackDevMiddleware from 'webpack-dev-middleware';\nimport webpackConfig from '../webpack.config.js';\n\nconst app = express();\nconst server = http.createServer(app);\nconst io = socket(server);\nconst upload = multer({ dest: `${ __dirname }/uploads` });\n\napp.disable('X-Powerd-By');\napp.use(require('cookie-parser')(credentials.cookieSecret));\napp.use(session({\n    resave: false,\n    saveUninitialized: true,\n    secret: credentials.cookieSecret\n\n}));\napp.set('port', process.env.PORT || 8081);\napp.use(express.static(__dirname + '/public'));\napp.use(webpackDevMiddleware(webpack(webpackConfig)));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({\n    extended: true\n}));\napp.use(expressJWT({ secret: credentials.jwtSecret }).unless({\n    path: ['/login', '/retrieve_password', '/activate_account', '/user/new', '/protected', /^\\/test/i] }));\n\n//--ROUTES--/ />\n\napp.get('/', (req, res) => {\n    res.send(\"Welcome dude !!!\");\n});\napp.get('/login', (_, res) => res.send(\"Login Page\"));\napp.post('/login', user.userLogin);\napp.get('/user', user.viewAll);\napp.put('/user', user.updateProfile);\napp.post('/picture', upload.single('picture'), picture.uploadPicture);\napp.post('/picture/delete', picture.deleteOne);\napp.post('/user/new', user.create);\napp.post('/user/update', user.updateProfile);\napp.get('/user/tags', user.tags);\napp.post('/user/tags', user.addTag);\napp.get('/test/login/:login', user.checkLogin);\napp.get('/test/email/:email', user.checkEmail);\napp.get('/account/register', user.renderForm);\napp.post('/account/change_password', user.changePassword);\napp.post('/account/retrieve_password', user.retrievePassword);\napp.post('/account/activate', user.isVerified);\napp.post('/account/reactivate', user.reactivate);\napp.post('/account/delete', user.Delete);\napp.post('/admin/userform/', admin.addFormItems);\n//--ROUTES--/ />\n\nio.on('connection', socket => {\n    socket.on('message', body => {\n        socket.broadcast.emit('message', {\n            body,\n            from: socket.id.slice(8)\n        });\n    });\n});\n\napp.use((err, req, res, next) => {\n    if (err.name === 'UnauthorizedError') {\n        res.redirect('/login');\n    }\n});\napp.use((req, res) => {\n    res.type('text/html');\n    res.status(404);\n    res.send('Error 404 Page');\n});\napp.use((err, req, res) => {\n    console.error(err.stack);\n    res.status(500);\n    res.send('Error 500 Page');\n});\nserver.listen(app.get('port'), () => {\n    console.log('Express started on http://localhost:' + app.get('port') + ' press Ctrl-C to terminate');\n});"]}