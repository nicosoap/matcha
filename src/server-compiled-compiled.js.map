{"version":3,"sources":["server-compiled.js"],"names":[],"mappings":"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","file":"server-compiled-compiled.js","sourcesContent":["'use strict';\n\nvar _express = require('express');\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _bodyParser = require('body-parser');\n\nvar _bodyParser2 = _interopRequireDefault(_bodyParser);\n\nvar _expressSession = require('express-session');\n\nvar _expressSession2 = _interopRequireDefault(_expressSession);\n\nvar _user = require('./controllers/user');\n\nvar user = _interopRequireWildcard(_user);\n\nvar _tags = require('./controllers/tags');\n\nvar tags = _interopRequireWildcard(_tags);\n\nvar _picture = require('./controllers/picture');\n\nvar picture = _interopRequireWildcard(_picture);\n\nvar _interactions = require('./controllers/interactions');\n\nvar interactions = _interopRequireWildcard(_interactions);\n\nvar _admin = require('./controllers/admin');\n\nvar admin = _interopRequireWildcard(_admin);\n\nvar _credentials = require('./credentials');\n\nvar _credentials2 = _interopRequireDefault(_credentials);\n\nvar _expressJwt = require('express-jwt');\n\nvar _expressJwt2 = _interopRequireDefault(_expressJwt);\n\nvar _multer = require('multer');\n\nvar _multer2 = _interopRequireDefault(_multer);\n\nvar _socket = require('socket.io');\n\nvar _socket2 = _interopRequireDefault(_socket);\n\nvar _http = require('http');\n\nvar _http2 = _interopRequireDefault(_http);\n\nvar _socketioJwt = require('socketio-jwt');\n\nvar _socketioJwt2 = _interopRequireDefault(_socketioJwt);\n\nvar _cors = require('cors');\n\nvar _cors2 = _interopRequireDefault(_cors);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar corsOptions = {\n    origin: 'http://localhost:3000',\n    optionsSuccessStatus: 200 // some legacy browsers (IE11, various SmartTVs) choke on 204\n}; // ************************************************************************** //\n//                                                                            //\n//                                                        :::      ::::::::   //\n//   server.js                                          :+:      :+:    :+:   //\n//                                                    +:+ +:+         +:+     //\n//   By: opichou <opichou@student.42.fr>            +#+  +:+       +#+        //\n//                                                +#+#+#+#+#+   +#+           //\n//   Created: 2016/09/01 18:27:53 by opichou           #+#    #+#             //\n//   Updated: 2016/09/29 18:27:53 by opichou          ###   ########.fr       //\n//                                                                            //\n// ************************************************************************** //\n\nvar app = require('express')();\nvar server = _http2.default.createServer(app);\nvar io = (0, _socket2.default)(server);\nvar upload = (0, _multer2.default)({ dest: __dirname + '/uploads' });\n\napp.disable('X-Powered-By');\napp.use((0, _cors2.default)());\napp.use(require('cookie-parser')(_credentials2.default.cookieSecret));\napp.use((0, _expressSession2.default)({\n    resave: false,\n    saveUninitialized: true,\n    secret: _credentials2.default.cookieSecret\n}));\napp.set('port', process.env.PORT || 3001);\napp.use(_express2.default.static(__dirname + '/public'));\napp.use(_bodyParser2.default.json());\napp.use(_bodyParser2.default.urlencoded({\n    extended: true\n}));\napp.use((0, _expressJwt2.default)({ secret: _credentials2.default.jwtSecret }).unless({\n    path: ['/login', '/retrieve_password', '/activate_account', '/user/new', '/protected', /^\\/test/i] }));\nio.use(_socketioJwt2.default.authorize({\n    secret: _credentials2.default.jwtSecret,\n    handshake: true\n}));\n\n//--ROUTES--/ />\n\napp.get('/', function (req, res) {\n    res.send(\"Welcome dude !!!\");\n});\napp.get('/login', function (_, res) {\n    return res.send(\"Login Page\");\n});\napp.post('/login', user.userLogin);\napp.get('/user', (0, _cors2.default)(corsOptions), user.viewAll);\napp.put('/user', user.updateProfile);\napp.post('/picture', upload.single('picture'), picture.uploadPicture);\napp.post('/picture/delete', picture.deleteOne);\napp.post('/user/new', user.create);\napp.post('/user/update', user.updateProfile);\napp.get('/tags', tags.tags);\napp.post('/tags', tags.addTag);\napp.get('/test/login/:login', user.checkLogin);\napp.get('/test/email/:email', user.checkEmail);\napp.get('/account/register', user.renderForm);\napp.post('/account/change_password', user.changePassword);\napp.post('/account/retrieve_password', user.retrievePassword);\napp.post('/account/activate', user.isVerified);\napp.post('/account/reactivate', user.reactivate);\napp.post('/account/delete', user.Delete);\napp.post('/admin/userform/', admin.addFormItems);\n//--ROUTES--/ />\n\nfunction now() {\n    var currentDate = new Date();\n    return currentDate.getDate() + \"/\" + (\"0\" + (currentDate.getMonth() + 1)).slice(-2) + \"/\" + currentDate.getFullYear() + \" @ \" + currentDate.getHours() + \":\" + currentDate.getMinutes() + \":\" + currentDate.getSeconds();\n}\n\nio.on('connection', function (socket) {\n    interactions.connect(socket.decoded_token.username, socket.id);\n    console.log(socket.decoded_token.username, 'connected on', now());\n    setTimeout(function () {\n        return socket.emit('message', {\n            body: \"Ceci est un message\",\n            from: socket.decoded_token.username,\n            read: false\n        });\n    }, 500);\n    setTimeout(function () {\n        return socket.emit('match', {\n            body: \"ceci est un match\",\n            from: socket.decoded_token.username,\n            read: false\n        });\n    }, 4000);\n    setTimeout(function () {\n        return socket.emit('message', {\n            body: \"Ceci est un message\",\n            from: socket.decoded_token.username,\n            read: false\n        });\n    }, 8600);\n\n    socket.on('message', function (body) {\n        socket.emit('message', {\n            body: body,\n            from: socket.decoded_token.username,\n            read: false\n        });\n    });\n    socket.on('like', function (body) {\n        socket.broadcast.emit('like', {\n            body: body,\n            from: socket.decoded_token.username,\n            read: false\n        });\n    });\n    socket.on('match', function (body) {\n        socket.broadcast.emit('match', {\n            body: body,\n            from: socket.decoded_token.username,\n            read: false\n        });\n    });\n    socket.on('visit', function (body) {\n        socket.emit('visit', {\n            body: body,\n            from: socket.decoded_token.username,\n            read: false\n        });\n    });\n    socket.on('disconnect', function () {\n        interactions.disconnect(socket.decoded_token.username, socket.id);\n        console.log(socket.decoded_token.username, 'disconnected on', now());\n    });\n});\n\napp.use(function (err, req, res, next) {\n    if (err.name === 'UnauthorizedError') {\n        res.redirect('/login');\n    }\n});\napp.use(function (req, res) {\n    res.type('text/html');\n    res.status(404);\n    res.send('Error 404 Page');\n});\napp.use(function (err, req, res) {\n    console.error(err.stack);\n    res.status(500);\n    res.send('Error 500 Page');\n});\nserver.listen(app.get('port'), function () {\n    console.log('Express started on http://localhost:' + app.get('port') + ' press Ctrl-C to terminate');\n});\n\n//# sourceMappingURL=server-compiled.js.map"]}